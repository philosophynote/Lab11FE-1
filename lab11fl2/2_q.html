<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script type="module">
    import { users } from './data/blogs.js'
    console.log(users)

    // user : {
    //   id: Number,
    //   name: String,
    //   email: String,
    //   blogs: BlogArray,
    //   comments: Array
    // }

    // blog: {
    //   id: Number,
    //   likeCount: Number,
    //   publish: Bool,
    //   title: String,
    //   tags: Array,
    //   comments: Array,
    // }
    
    const myId = 2
    const getUserById = Id => users.filter(el => el.id === Id)
    const targetUser = getUserById(myId)
    const getBlogProp = prop => blog[prop]
    const mostLikeCount = targetUser[0].blogs.reduce((acc, value) => acc < value.likeCount ? value.likeCount : acc, 0)
    // Q1: 自分のブログで最もlikeCountの多いもののtitleは？
    const mostLike = targetUser[0].blogs.filter(el => el.likeCount === mostLikeCount)
 
    mostLike.forEach(el => console.log(el.title))

    // Q2: 自分のブログで非公開になっているものの中の最大のlikeCountは？そのタイトルは？

    const isClose = (value) => !value.publish

    const mostLikeCountClose = targetUser[0].blogs.reduce((acc, value) =>  {
      return isClose(value) && acc < value.likeCount ? value.likeCount : acc;
    }, 0)

    const mostLikeClose = targetUser[0].blogs.filter(el => el.likeCount === mostLikeCountClose)

    mostLikeClose.forEach(el => console.log(el.title))
    // Q3: 自分のブログの公開率は？

    const getUserBlogById = Id => users.filter(el => el.id === Id)[0].blogs
    const userBlogs = getUserBlogById(myId)
    const userOpenBlog = userBlogs.filter(el => el.publish)
    const openBlogCount = userOpenBlog.length
    const totalBlogCount = userBlogs.length
    const openRate = openBlogCount/totalBlogCount
    console.log(openRate)

    // Q4: 自分のブログに最もついているタグは？、その個数は？

    const tagArray = userBlogs.flatMap(el => el.tags)

    // キーにタグ名、値に個数を入れたオブジェクトを作成する
    const tagObject = tagArray.reduce((acc,tag) => {
      !acc[tag] ? acc[tag] = 1  : acc[tag] += 1
      return acc
    },{})
    const maxCount = Object.values(tagObject).reduce((prev,current) => prev < current ? current : prev)
    const maxTags = Object.keys(tagObject).filter(el => tagObject[el] ===maxCount)

    console.log("タグ："+maxTags + "個数："+maxCount)

    // Q5: 全てのブログの中で最もLikeCountの多いもののタイトルは？
    const getAllBlogs = () => users.map(user => user.blogs).flat()
    const allBlogs = getAllBlogs()

    const getMostLiked = blogs => blogs.reduce((acc, cor) => acc.likeCount < cor.likeCount ? cor : acc)
    const getTitle = (blog) => blog.title 

    const mostLikedBlog = getMostLiked(allBlogs)
    const mostLikedTitle =  getTitle(mostLikedBlog)
    console.log(mostLikedTitle)

    // Q6: 全てのブログの中で最もLikeCountの多いもののユーザー名は？
    const getEachUserBlogs = (obj) =>
      Object.values(obj).reduce((acc,user) => {
          acc[user.name] = user.blogs
          return acc    
    },{})
    const eachUserBlogs = getEachUserBlogs(users)

    const getMaxLikeCount = blogs => blogs.sort((a, b) => a.likeCount > b.likeCount ? -1 : 1)[0]
    
    const getEachUserMaxLike = Object.entries(eachUserBlogs).map(([key, value]) =>[key,getMaxLikeCount(value)])
    console.log(getEachUserMaxLike)
    const hoge = getEachUserMaxLike.reduce((acc,cor) => {
      return acc < cor[1].likeCount ? cor : acc} ,0) 

    console.log (hoge[0])

    // Q7: 最もLike率の高いユーザーは？
    const totalLikeCount = users.map(user => user.blogs.reduce((a, b) => a + b.likeCount, 0))
    const totalBlogLength = users.map(user => user.blogs.length)
    const allRate = totalLikeCount.map((el,elIndex) => el/totalBlogLength[elIndex])
    const mostLikedElement = allRate.reduce((acc,cor,index) => users[index])
    console.log(mostLikedElement.name)
    //   const totalLikeCount = user.blogs.reduce((a, b) => a + b.likeCount, 0)
    //   const totalBlogLength = user.blogs.length
    //   user.likeRate = totalLikeCount / totalBlogLength
    //   return user
    // })


  </script>
</body>

</html>