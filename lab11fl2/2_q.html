<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script type="module">
    import { users } from './data/blogs.js'
    // console.log(users)

    // user : {
    //   id: Number,
    //   name: String,
    //   email: String,
    //   blogs: BlogArray,
    //   comments: Array
    // }

    // blog: {
    //   id: Number,
    //   likeCount: Number,
    //   publish: Bool,
    //   title: String,
    //   tags: Array,
    //   comments: Array,
    // }
    const myUid = 8

    // Q1: 自分のブログで最もlikeCountの多いもののtitleは？
    const getMyMostLikedCountTitle = uid => {
      return users
        .find(user => user.id === myUid).blogs
        .slice()
        .sort((a,b) => b.likeCount - a.likeCount)[0].title
    }

    console.log("A1")
    console.log(getMyMostLikedCountTitle(myUid))

    // Q2: 自分のブログで非公開になっているものの中の最大のlikeCountは？そのタイトルは？
    const getMyMostLikedCountTitleInPrivate = uid => {
      const mostLikedBlog = users
        .find(user => user.id === myUid).blogs
        .filter(blog => !blog.publish)
        .slice()
        .sort((a,b) => b.likeCount - a.likeCount)[0] 
      return [mostLikedBlog.likeCount, mostLikedBlog.title]
    }

    console.log("A2")
    console.log(getMyMostLikedCountTitleInPrivate(myUid))

    // Q3: 自分のブログの公開率は？
    const getMyPublicBlogRatio = uid => {
      const myBlogs = users.find(user => user.id === myUid).blogs
      const publicBlogs = myBlogs.filter(blog => blog.publish)
      return publicBlogs.length / myBlogs.length
    }

    console.log("A3")
    console.log(getMyPublicBlogRatio(myUid))

    // Q4: 自分のブログに最もついているタグは？、その個数は？
    const getTagsAttachedMyBlogs = uid => {
      return Object.entries(
        users
          .find(user => user.id === uid).blogs
          .reduce((ac,blog) => {
            blog.tags.forEach(tag => ac[tag] ? ac[tag] += 1 : ac[tag] = 1)
            return ac
          }, {})
      )
        .sort((a,b) => b[1] - a[1])[0]
    }

    console.log("A4")
    console.log(getTagsAttachedMyBlogs(myUid))

    // Q5: 全てのブログの中で最もLikeCountの多いもののタイトルは？
    const getMostLikedBlogTitle = () => {
      return users
        .flatMap(user => user.blogs)
        .slice()
        .sort((a,b) => b.likeCount - a.likeCount)[0].title
    }

    console.log("A5")
    console.log(getMostLikedBlogTitle())

    // Q6: 全てのブログの中で最もLikeCountの多いもののユーザー名は？
    const getMostLikedBlogUser = () => {
      return users
        .flatMap(user => 
          user.blogs.map(blog => 
            Object.assign(blog, {name:user.name, uid:user.id})
          )
        )
        .slice()
        .sort((a,b) => b.likeCount - a.likeCount)[0].name
    }

    console.log("A6")
    console.log(getMostLikedBlogUser())
    // Q7: 最もLike率の高いユーザーは？
    const getMostLikedUser = () => {
      return users
        .map(user => user.blogs
          .reduce((ac, blog, i) => {
            return i === user.blogs.length - 1 ? {name: user.name, likeRatio: ac/user.blogs.length} : ac + blog.likeCount
          }, 0)
        )
        .sort((a,b) => b.likeRatio - a.likeRatio)[0]
    }

    console.log("A7")
    console.log(getMostLikedUser())

  </script>
</body>

</html>